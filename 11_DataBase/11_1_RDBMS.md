# 관계형 데이터 모델

2020.07.11

## 기본 개념

![알디비](http://www.tcpschool.com/lectures/img_mysql_table.png)

### 릴레이션

- 하나의 개체에 관한 데이터를 릴레이션 하나에 담아 데이터베이스에 저장
- 데이터베이스에 있는 하나의 테이블이라고 생각하면 됨

### 속성

- 어트리뷰트, 릴레이션의 열
- 세로 항목, 파일 관리 시스템에서의 필드에 대응하는 개념

### 튜플

- 릴레이션의 행
- 개체의 인스턴스, 파일 시스템에서의 레코드에 해당하는 개념

### 도메인

- 속성 하나가 가질 수 있는 모든 값의 집합
- 가질 수 있는 option 값을 모아놓은 것
- 가질 수 있는 값이 다양하면 도메인을 정확히 정의하기가 어려움
- 프로그래밍에서 데이터 타입을 도메인(가질 수 있는 값의 크기 범위 지정), 변수를 속성으로 생각하면 ㄱㅊ

### null

- 릴레이션에 있는 특정 투플의 값을 모르거나 적합한 값이 없으면 null이라는 값을 사용할 수 있음
- 널은 거기에 없음을 가리키며 숫자 0이나 공백과는 다른 개념

### 차수(degree)

- 하나의 릴레이션에서 속성의 전체 개수를 릴레이션의 차수라고 함
- 모든 릴레이션은 최소 1이상의 차수를 유지한다
- 자주 변하지 않는다

### 카디널리티

- 하나의 릴레이션에서 투플의 전체 개수
- 자주 변한다

## 릴레이션과 데이터베이스 구성

관계 데이터 모델에서 릴레이션은 스키마와 릴레이션 인스턴스로 구성  

### 릴레이션 스키마

- 릴레이션의 이름과 릴레이션에 포함된 모든 속성의 이름으로 정의하는 릴레이션의 논리적 구조
- 릴레이션 스키마는 데이터베이스관리 시스템이 내부적으로 데이터 정의어를 이용해 정의함
- 릴레이션 내포라고도 부른다
```bash
# 이렇게 표현 가능
릴레이션 이름(속성이름1, 속성이름2, 속성이름3, ...)
```

### 릴레이션 인스턴스

- 어느 한 시점에 릴레이션에 존재하는 **투플들의 집합**, 즉 전체 데이터
- 릴레이션 인스턴스에 포함된 투플은 릴레이션 스키마에서 정의한 각 속성에 대응하는 실제값으로 구성
- 질의어 등으로 릴레이션 인스턴스의 투플을 검색하거나 새로운 투플 삽입과 기존 투플 삭제 및 수정을 수행함
- 릴레이션 그 자체
- 논리적으로 구조를 정의하는 릴레이션 스키마는 자주 변하지 않지만, 릴레이션 인스턴스는 수정이 자주 발생한다.

### 데이터베이스 스키마, 데이터베이스 인스턴스

- 데이터베이스는 릴레이션 여러개로 구성
- 데이터베이스 전체 구조를 의미하는 데이터베이스 스키마는 데이터베이스를 구성하는 릴레이션의 스키마를 모아놓은 것
- 특정 데이터베이스 스키마를 설계한다는 것은 모든 릴레이션의 스키마를 정의한다는 것

## 릴레이션 특성

### 유일성

- 투플은 유일, 하나의 릴레이션에서는 동일한 튜플 존재 불가. 모든 튜플에는 다른 튜플과 구별되는 유일한 특성이 있어야 함
- 키(key) : 투플을 유일하게 구별하기 위해 선정되는 속성이나 속성들의 모임

### 무순서

- 투플 순서는 의미없음
- 투플 순서가 바뀐다고 해서 다른 릴레이션이 될 수 없고, 순서와 상관없이 투플 내용이 같으면 동일한 릴레이션임
- 위치가 아닌 내용으로 검색됨
- 비슷하게 속성 사이의 순서도 무의미

### 속성값으로 원자값만

- 모든 속성 값은 더는 분해할 수 없는 하나의 값, 즉 원자값만 가질 수 있음
- 속성은 여러개의 값이나 다중값을 가질 수 없다

## 키의 종류

![키](https://file.okky.kr/images/1508076834504.PNG)

튜플을 구별하기 위해 모든 속성을 이용하는 것보다 일부 속성만 이용하는 것이 효율성을 높일 수 있음. 릴레이션에 포함된 투플들을 유일하게 구별해주는 역할은 속성 또는 속성들의 집합인 키가 담당함.

### 슈퍼키

- 유일성의 특성을 만족하는 속성 또는 속성들의 집합
- 유일성은 키가 갖춰야하는 기본 특성 : 구분이 되야되니까
- 슈퍼키 값이 같은 투플은 존재할 수 없음
- id 같은거

### 후보키

- 유일성과 최소성을 만족하는 속성, 속성들의 집합
- 최소성 : 꼭 필요한 최소한의 속성들로만 키를 구성하는 특성
- 슈퍼키 중에서 최소성을 만족하는 것이 후보키가 됨
- 릴레이션이 수정되도 후보키가 되기 위해 만족해야하는 유일성과 최소성의 특성은 유지되어야 함. 릴레이션 인스턴스만 보고 유일성과 최소성을 판단할 수 없음 
- 속성 집합(두개 이상의 속성도 키가 될 수 있음)

### 기본키(primary key)

- 여러 후보키 중에서 사용할 키를 반드시 선택해야 하는데 이것이 기본키
- 후보키가 1개만 존재하면 당연히 해당 후보키가 기본키
- 널 값을 가질 수 있거나, 자주 변경될 수 있는 속성은 기본키로 부적합함
- 단순한 후보키가 좋음 : 자릿수가 적은 정수나 단순 문자열인 속성으로 구성되거나 구성하는 속성의 개수가 적은 후보키
기본키 선정 과정 : 유일성을 만족하는 슈퍼키 중에서 최소성을 보장하는 후보키가 만들어지고 후보키 중에서 기본키 하나를 선택함

### 대체키

- 대체키는 기본키로 선택되지 못한 후보키들
- 대체키는 기본키를 대신할 수 있지만 기본키가 되지 못한 이유도 있음

### 외래키(foreign key)

- 어떤 릴레이션에 소속된 속성 도는 집합이 다른 릴레이션의 기본키가 되는 키
- 다시 말해 다른 릴레이션의 기본키를 그대로 참조하는 속성의 집합이 외래키
- 외래키는 릴레이션들 사이의 관계를 올바르게 표현하기 위해 필요
- 외래키가 다른 릴레이션의 대체키를 참조하는 것도 가능한데, 기본키로 선택받지는 못했지만 유일성과 최소성을 만족하므로 투플을 구분할 수 있기 때문
- 기본적으로는 참조하는 외래키는 
- 외래키로 참조하는 릴레이션이 다른 기본키를 가지고 있을 수 있다
- 참조되는 릴레이션에서의 기본키 혹은 대체키와 참조하는 릴레이션에서의 외래키의 속성명은 달라도 괜찮다. 다만 외래키 속성의 도메인과 참조되는 기본키 속성의 도메인은 반드시 같아야 한다 : 도메인이 같아야 연관성있는 투플을 찾기 위한 비교연산이 가능해진다
    - 고객 릴레이션의 고객 아이디 - 주문 릴레이션의 주문 고객
- 참조되는 릴레이션의 기본키가 아닌 다른 속성을 외래키가 참조한다면 : 기본키가 아니면 투플을 유일하게 구별하기 어렵기 때문에 참조되는 릴레이션에서 튜플을 검색하지 못한다(딱! 하나의 투플과 연관성이 있는!! 투플들!!! 검색!!)
- 외래키가 꼭 다른 릴레이션을 참조할 필요는 없음. 외래키 자신이 속한 라ㅣㄹ레이션의 기본키를 참조하도록 외래키를 정의할 수도 있음
    - 유저릴레이션에서 유저와 추천인 유저

### 외래키로 만들 수 있는 관계
관계 : 개체와 게체(릴레이션과 릴레이션)가 맺고 있는 의미있는 연관성  
매핑 카디널리티에 따라 달라짐  

#### 1:1(일대일)

- 개체의 각 인스턴스가 다른 개체 인스턴스 하나랑만 딱 관계를 맺을 수 있음
- 남편과 아내, 유저와 프로필(릴레이션이 분리되었다면)

#### 1:n(일대다)

- 개체 각 인스턴스가 다른 개체 인스턴스 여러개와 관계를 맺을 수 있지만 반대로는 하나만 
- 부서와 사원

#### n:m(다대다)

- 개체 각 인스턴스가 다른 개체 인스턴스 여러개와 관계를 맺을 수 있음
- 작가와 책(공저자)


## 관계 데이터 모델 제약조건

무결성 : 데이터의 결함이 없는 상태, 데이터가 정확하고 유효하게 유지된 상태를 일컬음.  
데이터베이스가 삽입, 삭제, 수정 연산으로 상태가 변하더라도 무결성 제약조건은 반드시 지켜져야 함. 데이터의 무결성을 보장하기 위해

### 개체 무결성 제약조건

- 기본키를 구성하는 모든 속성을 널값을 가질 수 없다
- 기본키를 구성하는 속성 전체나 일부가 널값이 되면 투플의 유일성을 판단할 수 없어 기본키의 본래 목적을 상실하게 되기 때문에
- 새로운 투플이 삽입되는 연산과 기존 투플의 기본키 속성 값이 변경되는 연산이 발생할 때 기본키에 널 값이 포함되는 상황에서는 연산의 수행을 거부하면 된다

### 참조 무결성 제약조건

- 외래키에 대한 규칙으로 연관된 릴레이션들에 적용됨
- 외래키는 참조할 수 없는 값을 가질 수 없다는 규칙 (= 좁게 말하면 외래키는 릴레이션의 기본키 혹은 대체키여야만 한다)
- 외래키가 자신이 참조하는 릴레이션의 기본키와 상관이 없는 값을 가지게 되면 두 릴레이션을 연관시킬 수 없으므로 외래키 본래의 의미가 없어진다. 그러므로 외래키는 자신이 참조하는 릴레이션에 기본키 값으로 존재하는 값, 즉 참조 가능한 값만 가져야 한다. 
- 위반사례 : 고객 릴레이션에 존재하지 않는 주문 고객이(없어서 참조할 수 없음) 주문을 했음
    - 참조하는 속성에 NULL이 들어왔다면 이걸 가지고 무조건 제약조건을 위반했다고 이야기할 수는 없다구 함. 참조 할 수 없는 상황은 아니기 때문에..