# 관계형 데이터베이스 설계

2020.07.13

## 개념설계)E-R 다이어그램

![이알](http://itwiki.kr/images/b/bf/EERD%ED%91%9C%EA%B8%B0%EB%B2%95.jpg)

- 걍 이런게 있다고 생각하면 좋을거같고 음... 면접때 써먹을 수도 있을 거 같음
- 현실 세계에 존재하는 데이터와 그들 간의 관계를 사람이 이해할 수 있는 형태로 명확하게 표현하기 위해 가장 널리 사용되는 모델, 개념적 모델링의 도구

## 논리설계) 릴레이션 스키마 변환

스키마는 데이터베이스에 저장되는 데이터 구조와 제약조건을 정의한 것(뭐가 속성으로 들어가는지.. 속성 튜플 속성 튜플 스키마는 잘 바뀌지 않고 인스턴스는 계속 변한다

### 릴레이션 스키마 변환 규칙

#### 1. 모든 개체는 릴레이션으로 변환한다

- E-R 다이어그램의 각 개체를 하나의 릴레이션으로 변환한다. 개체의 이름을 릴레이션의 이름으로 하고, 개체가 가진 속성도 릴레이션의 속성으로 그대로 변환한다
- 개체가 가지고 있는 속성이 복합 속성인 경우에는 복합 속성을 구성하고 있는 단순 속성만 릴레이션의 속성으로 변환한다(복합 속성을 펼쳐서 릴레이션으로 만든다)
- 개체가 가지고 있는 키 속성은 기본키로 변환한다

#### 2. 다대다 관계는 (관계)릴레이션으로 변환한다

- 다대다 관계를 하나의 릴레이션으로 변환한다. 관계의 이름을 릴레이션의 이름으로 하고, 관계의 속성도 릴레이션의 속성으로 그대로 변환한다.
- 단 관계를 맺고 있는 개체가 무엇인지가 중요하므로 관계를 맺고있는 개체들을 릴레이션으로 변환한 후 이 릴레이션의 기본키를 **관계 릴레이션(마름모)** 에 포함시키고 외래키로 지정한다
- **관계 릴레이션은 두 릴레이션의 두개의 기본키를 두개의 외래키로 참조한다(그래야 관계를 맺는게 됨)**
- 요약) 다대다 관계는 관계 릴레이션으로 구현하고 관계 릴레이션은 관계맺은 릴레이션 만큼의 외래키를 가짐

#### 3. 일대다 관계는 외래키로 표현한다

- 일대다 관계는 릴레이션으로 변환하지 않고 외래키로만 표현한다. 
- 세부규칙1) 일반적인 일대다 관계는 외래키로 표현
    - 1인 릴레이션의 기본키가 n 릴레이션의 외래키 참조
    - 1 릴레이션이 여러개의 n 인스턴스를 가질 수 있도록
    - 제조업체와 상품
- 세부규칙2) 약한 개체가 참여하는 일대다 관계는 외래키를 포함해서 기본키로 지정한다
    - 두 개체가 관계에 대해 종속적인 특징을 가질 때(한 개체가 독자적으로는 존재할 수 없고 다른 개체 존재 여부에 의존적), 다른 개체의 존재 여부에 의존적인 개체를 약한 개체, 다른 개체 존재 여부를 결정하는 개체를 강한 개체라고 함
    - 학부모와 학생, 비행기와 좌석개체
    - 그냥 외래키로만 표현해도 되긴 하지만, 종속적이라는 관계를 표현하기 위해 종속된 릴레이션의 기본키와 외래키를 묶어서 기본키로 지정하는 것
    - 승객이 좌석을 찾아갈때 좌석 번호만으로는 예약한 좌석을 찾을 수 없고, 비행기까지 알아야 함 => 강한 개체에 해당하는 비행기 릴레이션의 기본 키를 포함해서 약한 개체에 해당하는 좌석 릴레이션의 기본키를 지정하는 것이 타당

#### 4. 일대일 관계도 외래키로 표현하는데 +알파

- 일대일 관계도 릴레이션으로 변환하지 않고 외래키로만 표현한다. 데이터의 중복을 피하려면 특성에 따라 약간 다르게 처리해야 하므로 세부규칙을 나누어 적용한다.
- 세부규칙1) 일반적인 일대일 관계는 외래키를 서로 주고받는다
    - 두 릴레이션이 서로의 기본키를 외래키로 받아 참조하면 1:1 관계를 성립시킬 수 있다
- 세부규칙2) 일대일 관계에 필수적으로 참여하는 개체의 릴레이션만 외래키를 받는다
    - 두 릴레이션이 외래키를 하나씩 갖는 꼴이 되었는데, 일대일 관계가 항상 성립하지는 않고 선택적으로 성립한다면 굳이 그럴 필요가 없다
    - 일대일 관계에 필수적으로 참여하는 릴레이션에만 외래키를 포함시키면 필수적으로 참여하지 않는 릴레이션의 외래키에 null이 들어가는 낭비를 줄일 수 있다
- 세부규칙3) 모든 개체가 일대일 관계에 필수적으로 참여한다면, 릴레이션 하나로 합치는게 낫다.
    - 일대일 관계를 맺고있는 두 개체가 모두 관계에 필수적으로 참여한다면 그만큼 관련성이 있는 개체라는 말. 그러므로 두 개체에 해당하는 두 릴레이션을 하나로 합쳐 표현한다. 
    - 관계의 이름을 릴레이션의 이름으로 사용하고, 관계에 참여하는 두 개체의 속성들도 관계 릴레이션에 모두 포함시킨다. 그리고 두 개체 릴레이션의 기본키 속성을 조합하여 관계 릴레이션의 기본키로 지정한다. 

#### 5. 다중 값 속성은 릴레이션으로 변환한다.

- 관계 데이터 모델의 릴레이션에서는 다중 값을 가지는 속성을 허용하지 않는다 그러므로 다이어그램에 있는 다중 값 속성은 그 속성을 가지고 있는 개체에 해당하는 릴레이션이 아닌 별도의 릴레이션을 만들어 포함시킨다. 즉 관계 릴레이션을 만든다
- 속성 하나에 여러 개체가 한꺼번에 들어가야 한다면 릴레이션을 하나 더 만들어라라는 말이렸다..
- 이때 불필요한 중복을 제거하는게 좋다. 기본키 두개를 외래키로 삼는 릴레이션이랄까

#### 기타

- 속성이 많은 관계는 관계 유형에 상관없이 릴레이션으로 변환하는 것을 고려해야한다.
- 릴레이션의 개수를 최적화하는게 좋다. 릴레이션의 개수가 불필요하게 늘어나면 DBMS의 부담이 커지게 되기 때문이다. 외래키로만 표현이 간으한 일대일이나 일대다 관계는 릴레이션으로 변환하지 않는게 좋다 
- 개체가 자기 자신과 관계를 맺는 순환 관계도 기본 규칙을 그대로 적용하면 된다. 즉 순환 관계가 다대다일때는 릴레이션으로 변환하고, 일대일이나 일대다 관계일 경우에는 외래키로만 표현한다. 
- 다른 인스턴스의 기본키를 동일한 릴레이션 안에 다른 인스턴스가 외래키로 참조하는 경우일때


