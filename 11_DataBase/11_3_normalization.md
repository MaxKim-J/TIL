# 정규화

2020.07.16

## 정규화의 개념

- 정규화로 데이터베이스를 설계할 수 있다
- 데이터베이스를 설계한 후 설계 결과물을 검증하기 위해 사용하기도 한다

## 이상 현상

- 데이터베이스를 잘못 설계하면 불필요한 데이터 중복이 발생하여 릴레이션에 대한 데이터의 삽입, 수정, 삭제 연산을 수행할 때 부작용이 발생한다
- 이러한 부작용을 이상 현상이라고 한다. 이상 현상을 제거하면서 올바르게 설계해 나가는 과정이 정규화
- 이상현상이 발생하는 가장 큰 이유중 하나는 **중복**이다. 한 개의 릴레이션에 같은 데이터가 여러개 존재하는 것을 말하는데, 릴레이션은 집합이므로 중복된 데이터가 있는 것 자체가 모순이다. 모순이 생기지 않게 하려면 중복을 제거해야 하고, 중복을 제거하는 작업을 시행하는데 도움이 되는 것이 정규화 이론이다.

### 이상 현상 종류

- 삽입 이상 : 새 데이터를 삽입하기 위해 불필요한 데이터도 함께 삽입해야 하는 문제 => 속성이 최적화되지 않았음. 릴레이션에는 필요한 속성만 있어야 함
- 갱신 이상 : 중복 투플 중 일부만 변경하여 데이터가 불일치하게 되는 모순의 문제 => 릴레이션에서 객체가 가진 정보가 일관성있게 변화해야 한다. 회원은 똑같은데 어떤것만 수정되고 이러면 안됨
- 삭제 이상 : 투플을 삭제하면 꼭 필요한 데이터까지 함께 삭제되는 데이터 손실의 문제 => 어떤 주제의 릴레이션에서 어떤 인스턴스를 삭제했을 때 다른 중요한 정보도 삭제, 릴레이션을 잘못 짠것

### 왜 이상현상이 발생?

- 걍 한마디로 하면 **관련없는 속성을 하나의 릴레이션에 모아두고 있기 때문임.** 이상현상이 발생하지 않도록 하려면, 관련 있는 속성들로만 릴레이션을 구성해야 하는데 이를 위해 필요한 것이 정규화
- 정규화는 이상 현상이 발생하지 않도록 릴레이션을 관련이 있는 속성들로만 구성하기 위해 릴레이션을 분해하는 과정이다. 정규화를 통해 릴레이션 설계를 올바르게 완성할 수 있다.

### 함수 종속성

- 속성들 중 하나인 X, Y가  X → Y 의 관계를 가진다면, X가 Y를 함수적으로 결정하게 되면서 Y가 X에 함수적으로 종속되어 있다고 말할 수 있다.
- **쉽게 말하면 어떤 속성들중 하나를 알면 다른 속성의 정확한 값이나 범위를 알 수 있게 되는 관계를 말한다.** X 속성에 대해 Y속성이 항상 같은 값을 가지거나 X속성에 대해 Y속성이 갖는 값의 도메인이 항상 일정하거나, Y 속성에 비해 X 속성이 더 자세한 정보라서 X속성을 알면 Y속성을 알 수 있는 상황을 말한다.
- **함수 종속성이란 일반적으로 키의 성질을 정의한 것이라 말할 수 있다.** 일반적으로 키의 값이 정해지면 같은 투플에 포함된 임의의 속성값을 구할 수 있게 된다.
- 릴레이션 임의의 속성은 그 슈퍼키(튜플의 단일성을 보장하는 키)혹은 후보키에 함수 종속한다. 이러한 함수 종속성은 **자명한 함수 종속성**이라고 한다. 자명한 함수 종속성은 당연히 릴레이션에서 제외할 수 없지만, 문제는 그렇지 않은 함수 종속성, 즉 **자명하지 않은 함수 종속성**이다. 2단계 정규형부터는 이러한 자명하지 않은 함수 종속성을 제거하는 방식으로 정규화를 실현한다.

### 결합 종속성

얘는 잘 모르겠다..

- 키 자체에 다중성이 포함되었을때 나타나는 중복
- 프로젝션으로 나눈 릴레이션을 다시 결합하면 원래의 릴레이션으로 돌아가는 성질. 이때 결합 종속성이 명백하다. 그러나 릴레이션 내에 명백하지 않은 결합 종속성이 있으면 그 릴레이션은 4NF~6NF 정규화의 대상이 된다.
- 함수 종속성보다 고차원의 종속성으로 함수 종속성을 포함한다.
- 함수 종속성을 제거할 데로 제거해서 나눠질대로 나줘진 릴레이션, 즉 **키가 아닌 속성이 존재하지 않는 릴레이션에 대한 정규화 작업이다.** 키가 아닌 속성이 존재한다면 명시적인 함수 종속성이 존재하는데, 이때 이 릴레이션의 후보키를 나눠버리면 함수 종속성이 사라져(사실 릴레이션의 키 자체가 사라지는거지) 무손실 분해를 할 수 없다.

### 정규형

가장 중요한 것은 보이스코드 정규형과 5정규형으로 그 이외의 정규형은 역사적 이유 때문에 남아있을 뿐 그것을 목표로 하는 정규형은 없다. 그리고 높은 단계의 정규형은 자동으로 그 이전의 정규형 조건을 만족한다. 

1. **제 1 정규형** : 릴레이션이어야 한다. ⇒ 중복하는 행이 존재하지 않는다. 각 행과 열의 교차점은 도메인에 속하는 요쇼의 값을 딱 한개만 가진다. 모든 열의 값은 정의된 것이어야 하고 각 행은 항상 존재한다(NULL은 안된다)
    - 원자성 : 도메인에 속하는 요소 값을 딱 한개만 가진다는 조건은 투플 속성에 속하는 값이 더는 분해되지 않는 원자값만 가져야 한다는 이야기인데, 여기서 더는 분리할 수 없는 값이라는 말이 조금 애매한데, 의미가 있는 한 묶음의 데이터를 뜻한다고 생각하면 좋다.
2. **제 2 정규형** : (키 속성 → 키 아닌 속성 종속성 제거) 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속인 경우. 후보 키가 다른 속성과 종속성을 가지고 있을때, 키가 아닌 속성에 대한 함수 종속성을 제거하는 작업이다. 튜플 전체를 보면 값이 중복되지 않아도 그 일부에 중복이 존재하는 상태가 문제가 되는데, 이를 자명하지 않은 함수 종속성이라고 한다.
    - 무손실 분해 : 함수 종속성을 해결하려면 한 개의 릴레이션을 여러개의 릴레이션으로 분해하는 작업을 수행한다. 분해할 때 필요한 작업은 프로젝션으로, 한 개의 릴레이션에 대해 다른 두개의 패턴의 프로젝션을 해 두개의 릴레이션을 생성한다. 이때 무손실 분해란 분해한 다음의 릴레이션에 포함된 정보를 사용해 조인을 통해 원래의 릴레이션을 재구축할 수 있는 것을 말한다.
    - 무손실분해 할때 속성 여러개로도 후보키를 만들 수 있으니, 후보키로만 이루어진 릴레이션도 괜찮다.
3. **제 3 정규형** : (키 아닌 속성 → 키 아닌 속성 종속성 제거)  키가 아닌 속성 사이의 함수 종속성을 모두 제거하는 작업. 역시 무손실 분해를 통해 함수 종속성을 해결한다. 모든 속성이 기본키에 종속되어야하고 릴레이션의 유일한 결정자는 기본키다.
4. **보이스코드 정규형** : (키 아닌 속성 → 키 속성 종속성 제거)  자명하지 않은 함수 종속성이 모두 제거된 상태의 정규형. 따라서 이 이상 함수 종속성에 의한 무손실 분해는 할 수 없다. 왠만한 종속성은 모두 제거된 3NF 상태에서 남은 종속성은 키가 아닌 속성에서 후보키의 진부분집합에 대한 함수 종속성이다(Y → X). 이를 제거한다.
    - 3NF이지만 BCNF가 될 수 없는 릴레이션은 후보키가 되는 속성의 조합이 여러개가 존재한다. 속성을 결합해 여러개의 후보키를 설정하여 다른 정규형 조건을 만족하는지 타진하고, 어떻게 무손실분해를 할 수 있을지 결정해야한다.
    - 키가 아닌 속성이 존재할 때(키로부터 나오는 하나의 함수 종속성만 있을때), 키에 포함되는 속성이 1개뿐일 때 자동으로 5NF의 조건도 만족한다.
5. **제 4 정규형** : 다치 종속성에 의한 정규화. 키가 아닌 속성을 갖지 않는 릴레이션을 결합 종속성에 의해 **공통의 속성**을 포함한 두개의 릴레이션으로 무손실 분해할 수 있는 것이 다치종속이다. ⇒ 무손실 분해로 중복의 여지를 없앤다. 두개의 릴레이션은 똑같이 모두 후보키들을 가지고 있게 된다.
6. **제 5 정규형** : 명백하지 않거나 암시적이지 않은 모든 결합 종속성이 제거된 상태. 그냥 궁극적으로 투플 데이터 중복의 여지가 모두 제거된 상태로서, 이 이상은 릴레이션을 분해해도 의미가 없다. 
    - 4NF이면서 5NF가 아닌 결합 종속성은 AB, BC, CA 이렇게 세개로 나눠질 수 있는 결합 종속성을 뜻한다. 가령 학과에 따라서 들을 수 있는 수업이 달라진다고 생각하는 경우, 이러한 은근한 규칙을 표현하려면 {학과, 수업}릴레이션이 필요할 것이다.
    - 주로 함수 종속성처럼 특징이 없으므로 암시적이지 않은 결합 종속성을 찾는 것은 조금 어려울 것이다. 그 대신 4,5단계 정규화의 대상이 되는 릴레이션은 키가 아닌 속성을 가지지 않고 속성이 여러개인 경우로만 한정되기 때문에 대상을 찾기는 쉽다.
    - 결합 종속이 존재하는지 아닌지를 판별하는 방법은 실제로 프로젝션을 해서 다시 결합해보고, 결합한 다음에 릴레이션이 원래의 릴레이션과 같다면 결합 종속성이 존재할 가능성이 있는 것이다.### 요약

- 1 정규형(원자) : 데이터 베이스 한칸에 값 하나만 있는 릴레이션. 관계형 DB는 원자값만 들어가야 하니까 관계형 디비는 다 기본적으로 1 정규형 만족
- 2 정규형(완전 종속) : 1 정규형이면서 기본키 아닌 모든 속성의 결정자는 기본키가 된다. 하나의 기본키가 여러개 다른 속성의 결정자가 될 수 있어 이상이 발생한다. 기본키가 아닌 것이 결정자가 되는 부분 종속은 제거한다.
- 3 정규형(완전 종속에 이행적 함수 종속도 없음) : 2 정규형이면서 기본키 아닌 모든 속성의 결정자는 키 하나여야만 한다. 결정자가 되는 어떤 키는 오로지 하나의 종속 관계만
- 보이스 코드 정규향(완전 종속 + 이행적 함수 종속 없음 + 결정자는 무조건 후보키/기본키): 후보키가 여러개일 경우 발생. 종속 관계 갖는 키는 unique한 키다.