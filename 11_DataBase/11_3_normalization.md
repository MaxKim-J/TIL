# 정규화

2020.07.16

## 정규화의 개념

- 정규화로 데이터베이스를 설계할 수 있다
- 데이터베이스를 설계한 후 설계 결과물을 검증하기 위해 사용하기도 한다

## 이상 현상

- 데이터베이스를 잘못 설계하면 불필요한 데이터 중복이 발생하여 릴레이션에 대한 데이터의 삽입, 수정, 삭제 연산을 수행할 때 부작용이 발생한다
- 이러한 부작용을 이상 현상이라고 한다. 이상 현상을 제거하면서 올바르게 설계해 나가는 과정이 정규화

### 이상 현상 종류

- 삽입 이상 : 새 데이터를 삽입하기 위해 불필요한 데이터도 함께 삽입해야 하는 문제 => 속성이 최적화되지 않았음. 릴레이션에는 필요한 속성만 있어야 함
- 갱신 이상 : 중복 투플 중 일부만 변경하여 데이터가 불일치하게 되는 모순의 문제 => 릴레이션에서 객체가 가진 정보가 일관성있게 변화해야 한다. 회원은 똑같은데 어떤것만 수정되고 이러면 안됨
- 삭제 이상 : 투플을 삭제하면 꼭 필요한 데이터까지 함께 삭제되는 데이터 손실의 문제 => 어떤 주제의 릴레이션에서 어떤 인스턴스를 삭제했을 때 다른 중요한 정보도 삭제, 릴레이션을 잘못 짠것

### 왜 이상현상이 발생?

- 걍 한마디로 하면 **관련없는 속성을 하나의 릴레이션에 모아두고 있기 때문임.** 이상현상이 발생하지 않도록 하려면, 관련 있는 속성들로만 릴레이션을 구성해야 하는데 이를 위해 필요한 것이 정규화
- 정규화는 이상 현상이 발생하지 않도록 릴레이션을 관련이 있는 속성들로만 구성하기 위해 릴레이션을 분해하는 과정이다. 정규화를 통해 릴레이션 설계를 올바르게 완성할 수 있다.

## 함수 종속

- 속성의 부분집합이 X -> Y라면, 항상 하나라면 X가 Y를 함수적으로 결정하게 되면서 Y가 X에 함수적으로 종속되어 있다고 말할 수 있다. 
- 쉽게 말하면, 고객 아이디라는 기본키에 다른 고유한 다른 속성들이 붙어있다면, 고객 아이디가 고객 이름과 등급을 결정하니 고객 릴레이션에서 고객 이름과 등급 속성은 고객 아이디 속성에 함수적으로 종속되어 있음.
- 고객 아이디 -> (고객이름, 등급)
- 현재 시점에 릴레이션에 포함된 속성 값만으로 판단하면 안된다 + 속성 값은 계속 변할 수 있기 때문에 속성 자체가 가지고 있는 특성과 의미를 기반으로 판단해야 한다.(속성 자체의 특성)
- 기본키나 후보키가 아니더라도 결정자가 될 수 있다
- X가 같으면 모든 투플에서 Y는 반드시 같은 값을 가진다 => 종속
- 어떤 값을 결정하는 X를 판단할 수 있다. X는 속성, 혹은 속성의 집합이 될 수도 있고 기본키일수도 있고 아닐수도 있고.. 그냥 정의하기 나름임

## 그래서 정규화는 어캐함

- 함수 종속성을 이용하여 릴레이션을 연관성이 있는 속성들로만 구성되도록 분해해서 이상현상이 발생하지 않는 올바른 릴레이션으로 만들어나가는 과정을 정규화라고 함
- 정규화의 기본목표 : **관련이 없는 함수 종속성은 별개의 릴레이션으로 표현한다**
- 기본 정규형 : 1,2,3 + 보이스 코드
- 고급 정규형 : 4,5
- 릴레이션이 특정 정규형의 제약 조건을 만족하면 릴레이션이 해당 정규형에 속한다고 표현함
- 정규형의 차수가 높아질수록 요구되는 제약조건이 많아지고 엄격해짐

### 제 1 정규형

- 릴레이션에 속한 모든 속성의 도메인이 원자 값으로만 구성되어 있다
- 릴레이션에 속한 모든 속성이 더는 분해되지 않는 원자값만 가져야 한다
- 다중 값을 가지면 안된다 => 개체를 늘린다
- 관계 데이터베이스의 릴레이션은 모든 속성이 원자값을 가지는 특성이 있다고 설명했다. 그러므로 최소한 제 1 정규형을 만족해야 관계 데이터베이스의 릴레이션이 될 자격이 있다고 말할 수 있다.

### 제 2 정규형

- 릴레이션이 제 1 정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속이면 2 정규형이다. 
- 2 정규형이 아닌 릴레이션을 2 정규형인 릴레이션 2개로 분할할 수 잇다
- 기본키에 완전 종속되지 않는 속성이 존재하면 2 정규형이라 말할 수 없다 => 분리
- 분해된 릴레이션을 자연 조인하여 분해 전의 릴레이션으로 다시 복원할 수 있어야 한다.
- 릴레이션 분해할때 정보 손실이 발생하면 안된다
- 기본키에 모든 속성이 완전 함수 종속이라도, 함수적 종속 관계가 여러개인 릴레이션은 이상이 발생할 수 있다.

### 제 3 정규형

- 릴레이션이 제 2 정규형에 속하고 기본키가 아닌 모든 속성이 기본키에 이행적 함수 종속(화살표 * 2)이 되지 않으면 3 정규형이다. 기본키가 요것도, 요것도 정의
- 짧게 말하면 모든 속성이 기본키에 종속되어야 한다. 릴레이션의 유일한 결정자는 기본키다. 
- 이행적 함수 종속이 발생하면, 기본키 하나에 두개 이상의 속성이 종속자가 된다. 이 두 종속자는 서로 관련 없을 수도 있어서 릴레이션의 인테그리티를 해친다.

### 보이스/코드 정규형

- 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키이면 보이스/코드 정규형에 속한다 => 결정자가 모두 후보키!
- 하나의 릴레이션에 여러개의 후보키가 존재해버리는 경우, 제 3 정규형까지 모두 만족하더라도 이상현상이 발생할 수 있다. 후보키를 여러개 가지고 있는 릴레이션에 발생할 수 있는 이상 현상을 해결하기 위해 제 3정규형보다 더 엄격한 제약조건을 제시한 것이 보이스/코드 정규형이다. 
- 기본키, 기본키+기본키=기본키, 그리고 종속 릴레이션 이렇게 있는 경우
- 후보키가 아닌 경우에도 결정자가 될 수 있는 경우를 없앤다.

### 4,5 정규형

- 여기까지 만들면 변태 데이터베이스임
- 보이스 코드 정규형을 만족하면서 함수 종속이 아닌 다치종속을 제거해야한다.

### 요약

- 1 정규형(원자) : 데이터 베이스 한칸에 값 하나만 있는 릴레이션. 관계형 DB는 원자값만 들어가야 하니까 관계형 디비는 다 기본적으로 1 정규형 만족
- 2 정규형(완전 종속) : 1 정규형이면서 기본키 아닌 모든 속성의 결정자는 기본키가 된다. 하나의 기본키가 여러개 다른 속성의 결정자가 될 수 있어 이상이 발생한다.
- 3 정규형(완전 종속에 이행적 함수 종속도 없음) : 2 정규형이면서 기본키 아닌 모든 속성의 결정자는 키 하나여야만 한다. 결정자가 되는 어떤 키는 오로지 하나의 종속 관계만
- 보이스 코드 정규향(완전 종속 + 이행적 함수 종속 없음 + 결정자는 무조건 기본키): 종속 관계 갖는 키는 unique한 키다.