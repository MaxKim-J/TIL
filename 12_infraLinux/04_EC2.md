# EC2(Elastic Compute Cloud)

## 기본

- 가장 기본적이면서 널리쓰이는 인프라. 인터넷에 연결된 가상 서버를 제공해줌
- 클릭 몇번으로 서버를 생성할 수 있기 때문에 실제 서버를 구축하는 것보다 간편
- 사용한 만큼만 비용을 지불하면 되므로 비용절감
- PC나 서버와 똑같은 형태이며 window나 linux가 설치되어 있음. 가상 서버이기 때문에 모니터에는 직접 연결할 수 없고 터미널 도는 원격 데스트톱 연결로 접속
- start : EC2 인스턴스 시작. 시작하는 순간부터 과금. 1분을 사용하더라도 1시간 요금
- stop : EC2 인스턴스 정지. 운영체제를 종료해 시스템이 종료된 상태이며 사용 요금이 과금되지 않음
- terminate : EC2 인스턴스 삭제
- reboot : 재부팅. 운영체제를 종료한 후 다시 시작
- Root 장치 : 운영체제가 설치되는 스토리지. Root 장치로 EBS와 인스턴스 스토리지 사용 가능
- Kernel ID : 이시투가 사용하는 리눅스 커널. 리눅스 반가상화는 외부에서 리눅스 커널을 지정해줘야함. 다양한 리눅스 커널 선택 가능
- 가상화 형태 : 머신 이미지 종류 고를때 옆에 뜸
  - windows : OS의 커널을 수정할 수 없기 때문에 하드웨어 가상화, 전가상화로 실행이 됨
  - linux : OS의 커널을 수정할 수 있기 때문에 반가상화로 실행됨
  - PV : 반가상화
  - HVM : 하드웨어 가상화

## EC2 인스턴스 유형

- 인스턴스 : EC2에서 생성한 가상 서버를 인스턴스라고 함 => 서버 각각을 객체로 보고 있음
- 비용 절감과 효율성 : 사용량이 적으면 낮은 사양의 인스턴스를 사용하면 되고, 사용량이 많아 부하가 크면 높은 사양을 사용하면 됨
- 인스턴스 유형 이름 : m3.medium처럼 m에 세대를 뜻하는 숫자가 붙고, .뒤는 전체적인 사양 규모를 뜻하는 단어가 붙음
- 인스턴스 패밀리
  - 범용 : M1, M3로 시작함. vCPU, 메모리, 네트워크, 저장공간 등이 평균적인 사양으로 제공됨
  - 컴퓨팅 최적화 : C로 시작하는 인스턴스 유형. 다른 인스턴스 패밀리에 비해 메모리 대비 vCPU 비율이 높음
  - GPU 인스턴스 : G로 시작함. 고성능의 엔비디아 GPU가 장착되어 있음. CUDA, OpenCL 등을 실행할 때 사용
  - 메모리 최적화 : M2, CR1로 시작하는 인스턴스 유형. 다른 인스턴스에 비해 메모리 용량이 훨씬 큼
  - 스토리지 최적화 : H, I로 시작하는 인스턴스 유형. 다른 인스턴스보다 스토리지 용량이 훨씬 크거나 초고속 I/O 제공
  - 마이크로 인스턴스 : 가격이 가장 쌈. 낮은 vCPU 성능과 적은 메모리를 제공. 프리티어에서는 무료로 사용 가능 => t1이 기본이고, t2의 경우는 CPU 사용량이 높아질 때 CPU자원을 더 할당받아 성능을 높이는 Burst 기능을 제공
    - 리눅스와 윈도우 프리티어를 같이 쓰면 각각 750시간이라 두개 무료로 돌릴 수 있다
- vCPU : EC2는 가상 서버이기 대문에 가상화 소프트웨어를 통해서 실행됨. 가상화 소프트웨어를 통해 제공되는 CPU를 vCPU라고 함

## 인스턴스 구매 옵션

- 온 디맨드 인스턴스 : 필요할때 바로 생성해서 사용할 수 있는 방식. 과금은 1시간 단위로 이루어지며 1분을 사용했더라도 1시간으로 책정. 3가지 방식 중 요금이 가장 비쌈
- 스팟 인스턴스 : 경매 방식의 인스턴스. 인스턴스의 스펙을 설정하고 원하는 가격을 입력하면 입찰하면 수요와 공급에 따라 가격이 결정되고 높게 입찰한 사람에게 인스턴스가 할당됨. 해당 스펙의 인스턴스를 다른 사람이 더 높은 가격으로 입찰했다면 내가 가진 인스턴스는 종료됨
- 예약 인스턴스 : 일정한 예약금을 선불로 내면 인스턴스를 일정 기간동안 예약할 수 있으며 시간당 요금이 대폭 할인됨
- 업무 형태나 상황에 맞게 인스턴스 구매 방식을 선택하면 비용을 효과적으로 줄일 수 잇음

## EC2 인스턴스 세부 설정 

- Number of Instances : 생성할 인스턴스 개수, 1로 입력
- Purchasing Option : 스팟 인스턴스의 구매 옵션
- NetWork: VPC 네트워크를 선택하는 옵션.
- Subnet : 가용 영역(Availability zone)을 선택하는 옵션.
- Public IP: 공인 IP 할당
- IAM role : IAM 역할 설정
- Shutdown Behavior : 이시투 안의 운영체제를 종료했을 때 행동을 설정
- Enable Termination Protection : 실수로 삭제하는 것을 방지하는 옵션
- Monitoring : cloudWatch 세부 모니터링 사용 옵션.
- Tenency : 가상 서버 실행 방식을 설정하는 옵션, 공유 인스턴스와 전용 인스턴스 선택 가능


## 스토리지 설정

- Type : Root 장치인지 추가 장치인지 설정
- Device : Linux에 표시되는 장치 이름
- Snapshot : 스냅샷을 생성했을 때의 스냅샷 ID
- Size : 스토리지의 크기, 기가바이트의 단위
- Volume Type : 스토리지 볼륨 유형. SSD 종류 설정

## 태그 설정

- 인스턴스의 태그를 설정하는데, key-value 형식이며 다양한 내용 추가 가능
- 태그 별로 요금을 확인할 수 있음

## 보안그룹 설정

- 방화벽 설정
- Linux SSH 포트 22번이 기본적으로 설정된 보안그룹이 생성됨

## EC2 인스턴스 접속

- pem키 권한변경 후 ssh 명령어로 접속

```shell
chmod 600 keypair.pem
ssh -i keypair.pem ec2-user@54.249.18.120
```

## EBS(Elastic Block Store)

이거는 필요할때 다시 와서 배우면 될듯

- EC2 인스턴스에 장착하여 사용할 수 있는 가상 저장 장치
- EBS는 인스턴스에서 제공하는 기본 용량보다 더 사용해야 할때, 운영체제를 중단시키지 않고 용량을 자유롭게 늘리고 싶을때, 영구적인 데이터 보관이 필요할때 등등 사용 가능
- 프리티어에서 사용 가능
- EBS는 EC2에 설치된 OS에서 그냥 일반적인 하드디스크나 SSD처럼 인식됨. 원하는 크기로 만들 수 있고, 성능 또한 원하는 수치로 설정할 수 있음.
- 그리고 사용자가 삭제하기 전까지는 데이터가 안전하게 유지됨
- Block : 블록 장치. 일정한 크기 단위로 읽고 쓰는 저장장치. 자기테이프, 플로피디스크, 하드디스크, 광학디스크
- Volume : EBS의 가장 기본적인 형태로 OS에서 바로 사용 가능한 형태
- Image : AMI를 줄여 부르는 말. OS가 설치된 형태이며 이 AMI로 EC2 인스턴스 생성
- SnapShot : EBS 볼륨의 특정 시점을 그대로 복사해 저장한 파일. 이 스냅샷을 사용하여 EBS볼륨과 AMI생성 가능
- IOPS : 저장 장치의 성능 측정 단위. AWS에서는 추가 비용을 지불하고 높은 성능의 EBS를 생성 가능
- EC2 인스턴스를 생성할 때 기본적으로 OS가 설치된 EBS 볼륨을 함께 생성하게 됨. => 그리고 일반적으로 이를 루트 장치로 사용하게 됨 => 왜지
- 인스턴스 스토리지를 Root장치로 사용하는 EC2인스턴스는 정지 기능이 없음