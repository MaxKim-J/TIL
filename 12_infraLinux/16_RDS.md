# RDS(Relation Databse Service)

관계형 데이터베이스를 손쉽게 생성하고 확장할 수 있는 서비스

## 설명

- 고성능, 대규모 DB를 운영하려면 전문적인 DB 운영 인력뿐 아니라 고성능의 서버가 여러대 필요함. 또한 전 세계를 대상으로 하는 서비스를 준비할 때 세계 곳곳에 DB서버를 구축하고 장애에 대비해 이중화 구성을 하는 것도 실적으로는 어려움
- RDS를 이용하면 클릭 몇번만으로 손쉽게 DB인스턴스를 생성할 수 있고 사용량이 늘어나면 스토리지 용량과 IOPS를 증가시켜 성능 확장이 가능함. 또한 장애가 발생해도 FailOver기능을 통해 정상적인 서비스 제공이 가능하도록 구성할 수도 있음. Read Replica를 이용하여 읽기 성능도 향상시킬 수 있음
- RDS의 손쉬운 생성과 확장으로 인해 DB전문인력이 필요하지 않게 되어, 시간과 비용을 절감할 수 있음.
- EC2 인스턴스에 직접 데이터베이스 엔진을 설치해서 운영할 수도 있음(ㅋ) 이 경우 EC2 인스턴스 서버 관리는 물론 데이터베이스 관리까지 해야 하는 부담이 있음. 또한 장애에 대비한 이중화와 FailOver기능, Read Replica까지 모두 직접 설치하고 구성해야 하는 불편함이 있음

## RDS DB 인스턴스 클래스

- EC2와 비슷한게 인스턴스라는 개념이 있고 사양이 나누어져 있음
- db.m3.medium 이런식으로 db로 시작하며 인스턴스 패밀리인 m에 세대를 뜻하는 숫자가 붙고, 점 뒤는 전체적인 사양 규모를 의미하는 단어가 붙음
- DB 인스턴스 클래스
  - 마이크로 인스턴스 : 가격이 가장 쌈. 낮은 vCpu 성능과 적은 메모리를 제공함. 프리티어에서는 이 유형을 무료로 사용 가능
  - 스탠다드 : vCPU, 메모리, 네트워크 등이 평균적인 사양으로 제공됨
  - 메모리 최적화 : 다른 인스턴스 클래스보다 메모리 용량이 훨씬 큼
- 온 디맨드 인스턴스 옵션이 디폴트라 사용한 시간만큼 요금을 지불하는 방식으로 사용. RDS DB 인스턴스는 EC2 인스턴스와는 달리 SSH나 원격 데스크톱으로는 접속할 수 없음
- 예약 인스턴스도 존재(약정) - Light, Medium, Heavy

## 데이터베이스 엔진과 라이선스 모델

- 데이터베이스 소프트웨어. 엔진에 따라 라이선스 모델이 다르며 사용 요금 또한 차이가 있음
- MySQL: 추가요금 x
- PostgreSQL: 추가요금 x근데 요금이 MYSql보다는 높음
- Oracle: 2개
- Microsoft SQL Server : 3개(프리티어 하나 포함)

## 생성

1. 리전 선택 => Launch DB Insatnce => 엔진 선택
2. 다중 가용 영역 복제와 고성능 I/O를 제공하는 Provisioned IOPS Storage 사용 여부(추가 요금 발생)
3. 세부 설정하기

   - License Model : 라이센스 설정
   - DB Engine Version : 특정 버전을 사용하는 환경인지 확인하기
   - DB Instance Class: 생성할 DB 인스턴스 클래스(프리티어에서는 t1)
   - Multi-AZ Deployment : 장애에 자동으로 대처하는 Failover 기능을 위한 다중 가용 영역 복제 옵션
   - Allocated Storage: 데이터를 저장할 스토리지의 용량 5GB부터 3072GB까지
   - Use Provisioned IOPS : 고성능 I/O 옵션. 스토리지의 읽기 쓰기 성능을 원하는대로 조절 가능
   - DB Instance Identifier : DB 인스턴스의 이름
   - Master Username : 관리자 계정, admin으로 설정
   - Master Password, Confirm Password : 관리자 계정 비밀번호

4. 추가 설정하기

   - VPC: 네트워크 VPC
   - DB Subnet Group : DB인스턴스가 위치할 서브넷
   - Publicy Accessible : DB를 외부에서 접근할 수 있게 하는 옵션 NO로 설정하면 설정된 VPC 내부에서만 접속할 수 있게 됨
   - Availability Zone : 가용 영역. EC2 인스턴스에서 DB에 접속한다면 같은 AZ에 있는 것이 좋음
   - VPC Security Group : 방화벽 설정. 나중에 DB 인스턴스 전용으로 따로 생성해야 함
   - Database Name : 생성할 디비의 이름. 아무것도 입력하지 않으면 나중에 인스턴스에서 서버만 실행되고 DB는 생성되지 않음
   - Database Port : 디비의 접속 포트
   - Parameter group: 필요한 매개변수 집합. DB 인스턴스 생성 후 파라미터 그룹 추가 가능
   - Option Group : DB 옵션.
   - 이외에 백업 옵션, 백업 데이터 유지 기간, 백업 시간, 마이너 버전 업데이트 옵션, 점검 시간 등 설정 가능

5. 보안 그룹 설정

- 이렇게 생성이 되었더라도 엔드포인트 주소로는 접근이 안되는데 보안 그룹에서 접속이 차단되어있기 때문임
- 보안 그룹을 디폴트인 default로 설정했음. default는 모든 트래픽에 대해 인바운드가 열려있지만 접속 가능한 IP대역은 자기 자신으로 설정이 되어있음. 즉 같은 default VPC 보안 그룹 안에서만 접속이 허용되므로 외부에서는 접속할 수 없음.
- 외부에서 엔드포인트 주소에 접속하려면 RDS DB 인스턴스 전용 Security Group을 생성함. 그리고 MySql 포트를 열어놓음
- 보안 그룹 생성 페이지로 이동해서 Inbound 규칙을 TCP, 엔진 고유 포트번호 입력, 접속 가능한 IP 대역을 Anywhere로 설정하기(실무에서는 MyIp를 선택하여 자신의 IP만 접속가능하도록 설정하거나, Custom IP를 선택하여 특정 IP 대역을 설정하도록 함)
- 그리고 RDS 페이지로 돌아와 보안 그룹 설정을 해줌

## 사용

- workbench같은 GUI툴에서 포트번호, ip주소, 계정 이름과 패스워드 입력하면 접속 가능

## 스냅샷

- RDS DB 스냅샷은 DB의 전체 내용 중 특정 시점을 파일로 저장한 형태
- 자동 백업과의 차이 : 인스턴스를 삭제하더라도 스냅샷은 계속 유지되고 다른 리전으로 복사도 가능. 자동 백업은 인스턴스 삭제하면 없어짐
- 스냅샷 생성 : Take DB SnapShot => 스냅샷으로 다른 DB 인스턴스를 생성하거나 다른 리전으로 복사가 가능 => Restore Snapshot
- 스냅샷으로 인스턴스 생성하면 그 때의 데이터도 같이 복사되나? => 되는듯 AMI랑은 좀 다름

## 롤백

- 인스턴스를 생성할때 자동 백업 설정을 했다면 DB의 특정 시점을 RDS DB로 생성할 수 있음. 이미 있는 DB 인스턴스의 내용을 되돌리는 것이 아니라 특정 시점의 내용을 DB인스턴스로 새롭게 생성하는 방식
- workbench로 DB의 내용을 수정하기 전의 내용으로 복구 가능
- Restore to point in time: 시간대 설정 가능하고, 자동 백업을 했던 디비 인스턴스의 이름, 자동 백업의 특정 시점으로 새로 생성될 DB 인스턴스의 이름을 확인
- 인스턴스를 덮어쓰는게 아니라 새로운 인스턴스를 생성함 => 보안 그룹 설정 필요(귀찮..)

## Read Replica

- DB 인스턴스의 읽기 복제본을 만들어 성능을 향상하는데 사용(MySql만 지원한다고 함?)
- 서비스에서 읽기 위주의 작업이 많을 경우 Read Replica를 여러개 만들어 부하를 분산하는게 가능함. 쓰기 작업은 마스터에서 하고 읽기 작업은 Read Replica인 슬레이브 DB 인스턴스에서 실시한다면 마스터 DB 인스턴스의 부하를 줄일 수 있음
- 마스터 디비 인스턴스에 쓰기를 하면 자동으로 슬레이브 DB 인스턴스로 데이터가 복제됨. 단 쓰기 작업을 실시한 즉시 복제되는 것은 아니며 약간의 시간차가 있음
- Create Read Replica
  - 여러 리전에 생성할 수 있어 지역별로 읽기성능 향상 가능
  - 레플리카의 id는 구분을 쉽게 하기 위해 기존 DB 인스턴스의 id를 이용해서 작성하면 좋음(example-read-1)
  - 성능이 더 좋은 인스턴스 클래스로 바꿀 수도 있음
  - 스토리지 타입 설정 가능
- 얘도 사실 하나의 배다른 인스턴스임. 인스턴스 생성과 동시에 마스터에 대한 설정도 해야하므로 조금 더 오래걸림
- 생성된 레플리카 인스턴스의 엔드포인트 주소로 접속하면 마스터 DB와 동일한 데이터를 사용할 수 있음. 다만 읽기 전용이므로 INSERT, UPDATE, DELETE는 사용할 수 없음

## 스케일 업

- DB Instance Class: DB 인스턴스 클래스 변경하여 vCPU와 메모리 용량 늘리기 가능
- Allocated Storage: 스토리지 용량 늘리기 가능 => 용량을 줄일수는 없다
- IOPS값을 높여 I/O 성능 향상 가능
