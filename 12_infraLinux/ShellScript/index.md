# 리눅스와 쉘 스크립트

내가 이걸 공부하다니...

## 1. 리눅스와 쉘

- 운영체제의 본질 : 하드웨어를 쉽게 사용할 수 있도록 해주는 소프트웨어
- 쉘의 종류 : sh -> csh -> ksh -> **bash**
- sh : 최초의 유닉스 쉘
- bash : GNU 프로젝트의 리눅스 기본쉘 기본쉘을 대체하고 호환함($, #)
- CLI를 사용하는 이유 : 그래픽이 차지하는 리소스를 줄이기 위해서(시피유나 메모리의 사용량),
- 배쉬 커맨드라인 단축키
  - tab치면: 명령 자동완성
  - pwd: 현재 디렉토리
  - cd, ls
  - ctrl + c : 인터럽트 시그널을 보내 실행중인 프로세스를 중단
  - ctrl + a : 라인 맨 앞으로 커서 이동
  - ctrl : e : 라인 맨 뒤로 커서 이동
  - ctrl + r : 히스토리 검색모드로 전환

## 2. 리눅스 명령어

### 기본

- cd: 현재 작업 디렉토리를 지정한 디렉토리로 변경
- ls : 현 디렉토리의 파일 목록을 출력
- df : 마운트된 모든 장치에 대한 현재의 디스크 공간 통계 출력
- cd - : 바로 직전 디렉토리 왓갓
- ls -al : 파일들의 모든 정보, 숨겨진 파일까지 모두 출력
- ls -alh : 사람이 읽기 편한 용량으로 보여줌
- ls -alt : 시간순 정렬
- ls -al | awk `{print $9}` : 몇번째 파일명
- df -h : df의 휴머나이즈 옵션
- pwd : 현재 위치한 디렉토리의 절대경로를 출력
- mkdir : 디렉토리 생성
- rmdir : 디렉토리를 삭제 (rmdir -rf : 안에 파일이 있으면 삭제할 수 없음)
- touch : 비어있는 파일을 만들어줌
- mount : 디스크 장치를 표시하거나 가상 파일 시스템(공유폴더?)으로 지정한 디렉토리를 연결(AWS EBS같은거 연결할때)
- mount -t nfs 아이피:nfs /mnt: 마운트 타입 지정해서 특정 파일시스템에 연결, 연결하고나서 rmdir로 삭제가능
- umount : 마운트 해제
- stat : 지정한 파일의 파일통계를 출력

### 파일 관련

- touch : 지정한 이름의 비어있는 파일을 생성(이게 더 잦은 목적)하거나 파일이 있는 경우 타임스탬프 업데이트. 파일을 연달아 쓰면 연달아 만들어준다
- cat : 지정한 파일의 내용을 출력(catenate)
- head : 지정한 파일의 1라인부터 지정한 라인까지 출력 (head -n 5 testfile.txt) n은 넘버옵션
- tail : 지정한 파일의 마지막 라인부터 지정한 라인까지 출력 (tail -n 2 testfile.txt). 로그같은거 출력할때 유용함
- cp : 파일을 복사함. r, f, p 옵션 사용. 원본 파일 패스/이름 복사파일패스/이름
  - r : 하위 디렉토리 포함
  - f : 같은이름의 파일이 있으면 강제로 덮어씌우기
  - p : 실행권한 그대로 복사
- mv : 지정한 파일을 지정한 위치와 이름으로 이동(원본 파일이 안남아있음)
- rename : 지정한 규칙에 따라 여러개의 파일 이름을 변경함 - 정규표현식 사용 가능
- rm : 지정한 파일의 삭제. 휴지통이 없기때문에 복구가 불가능함 r,f,p 옵션은 똑같음. 파일은 rm -f, 디렉토리는 삭제는 rm -rf로
- less: 상하로 커서 이동이 가능한 파일 보기. cat보다는 긴 파일을 쉽게 볼 수 있다는 장점
- ln : ln 옵션 링크의 원본파일패스/이름 링크파일패스 이름, 지정한 파일에 대한 심볼릭링크(바로가기)나 하드링크를 생성
  - s옵션: 심볼릭 링크 만드는 옵션
  - 심볼릭 링크는 약간 포인터처럼 ls -al 해보면 다른 파일을 가리키는 꼴로 존재함
  - 심볼릭 링크에서는 원본파일이 삭제되거나 변경되면 링크가 깨졌다는 표시가 나옴
- paste : 지정한 파일들의 행을 읽어 탭으로 구분하여 병합함(가로로 병합)
- dd : dataset definition - 블록 단위로 데이터셋을 정의하여 파일을 쓰고 읽음. dd if=인풋 of=아웃풋 bs=바이트(크기) count=블럭복사횟수
  - dev/urandom : 리눅스의 난수 생성기
  - 밴치마킹?도 한다는데 잘 모르겟다
- tar : 지정한 데이터 및 디렉토리를 하나의 파일로 만듬. 묶여있는 파일을 풀거나 압축이 되어있든 안되어있는 파일을 풀음
  - tar -cvzf : 압축하기
  - tar -xvzf : 압축풀기
  - tf : 내부 탐색
  - c : create
  - v : verbose
  - z : 집으로 압축
  - f : 파일명을 명시적으로
  - tgz : 타르로 지집 압축까지 했음 - 당최 지집(gzip)이 뭐냐..?

### 프로세스

메모리에 올라가있는 작업단위, 명령어로 여러 사항을 확인해볼 수 있음

- ps : 시스템에서 실행중인 프로세스에 대한 정보를 출력(process status)
  - ps -ef : 유저명, PID, PPID(부모)
  - ps aux : cpu, 메모리 사용 퍼센테이지도 나옴
  - 전체 스크립트 명령어를 짜르지 않고 표시하려면 axfwwwww 이런식으로 하면 프로세스 명령어가 나옴
- pstree : 프로세스에 대한 정보를 트리구조로 출력함. 프로세스의 부모자식간 관계(옵션이 없음)
- top: 프로세스 목록을 일정 시간마다 새로고침하여 화면에 출력하는 툴. 시스템의 전반적인 상황 모니터링
  - 프로세스 리스트 : 특정 기준에 따라 정렬되어있음 코어별 통계, 좀비 프로세스 등등
  - ctrl c, q로 빠져나올 수 있음
- nohup : no hangup 쉘스크립트를 데몬으로 실행. 데몬은 한번 실행하면 백그라운드에서 계속 되는 프로그램. 실행했을때 결과는 아웃풋 파일로 리다이렉트
  - 특정 상태에 도달했을 때 무언가 해야하는 상황에서 활용
- kill : 지정한 프로세스에 지정한 시그널을 보내 프로세스 종료
  - kill -2, kill -INT 프로세스 번호
  - Kill -9 프로세스 번호(-KILL)

### 네트워크

서버 서버 클라이언트 사이의 통신망과 관련된 명령어

- ifconfig : 네트워크 인터페이스(장치)의 활성 비활성화 및 설정
  - 이더넷 번호, IP주소, 넷마스터 관련 정보 출력
- ip address show eth0 : ip 관련 정보 조회 및 설정
  - /etc/network/interfaces : 네트워크 정보 저장(우분투)
  - /etc/sysconfig/network-scripts : 네트워크 정보(레드햇)
- netstat : 네트워크 프로토콜의 통계와 연결상태를 출력
  - netstat -nltpu : TCP, UDP 통신에 대하여 열고 있는 포트 모두 보기
  - netstat -nltp : TCP만 보기
  - netstate -tanu : 전체 클라이언트
  - 포트에 대한 정의 /etc/services - 특정 통신에 대해 정해져있는 포트번호
  - 리슨상태도 보여줌 (state)
- ss : 네트워크 소켓의 통계와 연결상태 출력
- iptables : 패킷 필터링 도구로 패킷의 출입을 제한하는 방화벽 구성이나 NAT 구성에 사용. 포트 리다이렉션, 포워딩 등에 사용
  - iptables -nL : 패킷 필터링 규칙 조회(source - 보내는 쪽, destination - 목적지)
  - systemctl status iptables : 활성화 확인
  - input, forward, output
  - 방화벽 기본 정책 : 들어오는 통신은 일단 다 막아두고 필요한 것만 열어둠
- ufw : iptalbes의 제어를 쉽게 하기 위한 도구
- ping : ICMP 프로토콜의 응답 확인 도구. OSI 7중 네트워크 계층, 서버와 서버 사이에 통신이 되고있는지 알 수 있음 ping + IP 또는 hostname
- wget : 웹서버로부터 컨텐츠를 가져오는 도구(world wide web + GET - 웹주소로 다운로드) wget + URL
- curl : 다양한 프로토콜을 사용하여 데이터를 전송하게 해주는 도구(주로 HTTP 통신 잘 되고있는지 응답 보는 용도로 사용)
  - L : 리다이렉션 링크를 따라가기(301이 떠도 리다이렉되는 방향으로 알아서 이동함)
  - k : HTTPS 인증 무시
  - s : 사일런트 모드, 통계값 출력하지 않기
  - /dev/null : urandom처럼 내장 디렉토리인데, 출력 결과를 /dev/null로 보내면 출력 결과를 저장하지 않겠다는 뜻으로, 결과값 파일이 남아 경로를 지정해줘야 되는 경우 dev/null을 사용해 무시가능
- route : 네트워크의 경로 정보의 출력, 변경하는 도구(gateway - 외부 네트워크 게이트웨이의 주소, genmask - 목적지의 네트워크 주소, ref, use - 경로를 탐색하거나 참조한 횟수)
  - route -n : IP주소로 변환

### 검색/탐색

- find: 지정한 파일명 또는 정규표현식을 이용하여 파일을 탐색(find 옵션 찾기시작패스 익스프레션)
  - 파일명을 검색
  - exp를 쓰려면 -name, -type, -perm, -empty 등의 옵션 사용 가능. 꼭 파일명만 찾을 수 있는 것은 아니고
  - 찾기시작패스 : 어느 디렉토리부터 하위에서 파일을 검색할것인지
- which : 환경변수 PATH(${PATH})에 등록된 디렉토리에 있는 명령어를 찾아주는 도구. 명령어의 위치를 화면에 출력
- **grep** : 텍스트 검색 기능을 가진 도구로, 파일이나 표준입력을 검색하여 정규 표현식과 맞는 줄을 출력
  - grep 옵션 "찾을 문자열" 파일명또는패스(/\*이런것도 가능)
  - i : 대소문자 구분 안함
  - r : 하위디렉토리 포함
  - v : 제외
  - c : 개수
- history : 명령어를 수행한 목록을 출력
  - cat .bashrc : 환경변수 확인. 이때 히스토리 타임스탬프 관련 환경변수도 포함

### I/O

- echo : 문자열 화면에 그대로 출력
- redirection : 표준 스트림(stdin, stdout, stderr)을 부등호를 사용한 지정한 위치로 보낼 수 있는 방향지정 옵션
  - 명령 리다이렉션기호 파일명
  - > : 초기화해서 덮어씌우기(echo a > a, cat a)
  - > > : 아랫줄에 추가하기(echo zzz > a, cat a)
  - > | : 쉘스크립트에서 파일이 없으면 생성해서 리다이렉션

### 유저관련

- chmod: 파일이나 디렉토리의 모드, 접근권한을 변경하는 도구(permission)
  - r: 읽기, x: 실행, w: 쓰기
  - ls -al을 하면 3개의 권한이 나옴. 왼쪽부터 파일의 소유자, 파일이 속한 유저그룹, 그룹외 소유자외 유저의 권한
  - 보통은 유저명과 그룹명이 같음
  - chmod 권한정보 파일명
  - 권한을 이진수 자릿수로 표현할수 있음 숫자를 더해서 표현하기도 함- chmod 664 이렇게
- chown : 파일의 소유권을 바꾸기 위한 도구 (chown 유저:유저 파일명)
- sudo : root 사용자의 보안 권한이용 명령어 실행
- who : 현재 시스템에 로그인한 사용자 목록 출력 - w

### 기타

- date: 현재 시간
  - d : 특정 시점의 날짜와 시간 지정. 문자열로 막 여러가지 변경 가능
  - -1 day, 1 day ago
  - week / month / hour / minute / second - 과거 미래의 시간
  - 날짜의 출력 형식 수정 : date '+%Y-%m-$d %H:%M:%S'
  - 쉘스크립트에서 시간을 불러오거나 쓸때 활용
- seq : 지정한 규칙으로 숫자열을 출력
  - seq 1 10 : 1부터 10까지 출력
  - w : 앞자리에 0붙이기, 가장 큰 숫자에 맞춰서 작은자릿수에 0 채워줌
  - f : 형식을 지정해서 출력 가능 %0자릿수 g뭐 이런식...약간 파이썬 옛날 포맷팅같음
- more : CLI쓸때 유용. 터미널창 크기에 맞춰서 한페이지만 보여주고 키 입력을 기다림. cat보다 좀더 효율적으로 파일 조회 가능
- watch : 지정한 명령어를 지정한 시간마다 재실행하여 화면에 출력하는 도구 watch프로세스를 종료할때마다 반복. interval 주기
  - watch ls : 매 2초마다 ls를 실행
  - n 으로 인터벌 시간 지정 가능
  - 일정 시간 단위로 무언가 확인
- crontab : 리눅스의 잡 스케쥴러의 내용을 출력하거나 편집할 수 있는 도구. 지정한 시간에 지정한 작업을 실행하게 해주는 스케쥴러 툴
  - l : 등록한 크론잡
  - e : 크론잡을 등록할 수 있도록 크론잡을 편집할 수 있게 해줌
  - r : 다지움. 크론잡이 많은 경우도 있는데 r을 쳐버리면 미친사고...
