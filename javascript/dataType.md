# 자바스크립트 데이터 타입
2020.04.29  
기본적인 내용이지만 확실히 알쟈

## 종류
일반적으로 기본형은 할당이나 연산시 복제되고 참조형은 참조된다고 알려져 있음  
엄밀히 말하면 둘다 복제하긴 함 
- 기본형은 값이 담긴 주솟값을 바로 복제하는 반면
- 참조형은 값이 담긴 주솟값들로 이루어진 묶음을 가리키는 주솟값을 복제
### 기본형(원시타입)
number, string, boolean, nool, undefined, (+symbol)

### 참조형
object, array, **function**, date, regExp, (+Map, Set)

## 메모리 데이터 식별자 변수
- 자바스크립트는 지정된 데이터 타입 따르는걸 강제하지 않음 
- number 타입은 정수형 부동소수점형을 구분하지 않고 무조건 8바이트를 확보
- 문자 타입은 또 특별히 정해진 규격이 없음
- 모든 데이터는 바이트 단위의 식별자 : 메모리 주소값을 통해 서로 구분하고 연결
- 변수 : 변할 수 있는 수
- 식별자 : 변수명, 어떤 데이터를 식별하는데 사용하는 이름

## 변수 선언과 데이터 할당 

### 변수영역과 데이터영역의 분리
- 변수선언: 메모리 공간 확보, 식별자 지정 => 컴퓨터가 식별자를 검색해 값을 내놓는다, 선언할 당시에는 undefined
- 데이터 할당 : 식별자를 검색해서 그곳에 문자열을 할당함. 시레 메모리 주소 위치에 직접 저장하지는 않고, 데이터를 저장하기 위한 별도의 메모리를 다시 확보해서 문자열 지정하고, 그 주소를 다시 변수영역에 저장하는 식으로 이루어짐
```js
const a = "abc";
// 1003주소 - 식별자:a, 값 :@5004 (변수영역)
// 5004주소 - 'abc' (데이터 영역)
```
- 데이터 영역과 변수 영역을 분리하는 이유 : 형변환을 자유롭게 할 수 있기 위해 + 메모리를 더욱 효율적으로 관리하기 위해
> 미리 확보한 공간 내에서만 데이터 변환이 가능하다면  
 변환된 데이터를 다시 저장하기 위해서는 확보된 공간을 변환된 데이터 크기에 맞게 늘리는 작업을 해야함
 >> 해당 공간보다 뒤에 저장된 데이터들을 모두 뒤로 옮기고 이동시킨 주소를 각 식별자에 다시 연결하는 귀찮은 작업을 해야함 

### 중복 데이터 처리

- 문자열 'abc'의 마지막에 'def'를 추가하려고 하면 컴퓨터는 'abc'가 저장된 공간에 'abcdef'를 할당하지 않고 'abcdef'라는 문자열을 새로 만들어 별도의 공간에 저장하고 그 주소를 변수공간에 연결함
```js
a += 'def';
// 변수영역 1003주소 - 식별자: a, 값: @5005 (주소 바뀜)
// 데이터영역 @5005주소 -'abcdef'
```

- 같은 값이 다른 변수에 할당되었을 경우에 대비하여, 한 값에 대해서는 하나의 메모리 공간만 사용하고 
- 그 값이 여러 변수에 할당되었을 경우 값이 그 데이터영역의 주소를 가리킨다
- 이렇게 하지 않고 변수가 할당되었을 때 값을 계속 만들어 데이터 영역에 계속 넣으면 메모리를 계속 차지하게 되고 낭비가 발생한다.

## 기본형과 참조형의 차이

### 변경 가능성
- 변수와 상수를 구분짓는 변경 가능성의 대상은 **변수 영역 메모리**
    - 한 번 할당이 이루어진 변수 공간에 다른 데이터를 재할당할 수 있는지 여부가 관건
    - const는 안되는거고 let은 되는거고
- 불변성 여부를 구분짓는 변경 가능성의 대상은 **데이터 영역 메모리**

### 불변값
- 불변 자료형들의 변경은 **새로 만드는 동작**을 통해서만 이루어진다.
- 기존에 할당된 변수를 수정해도 새로운 값을 만들어 데이터 영역에 넣음 => 기존의 값은 변경되지 않는다
- 데이터 영역의 자료형들은 gc되지 않는 이상 **한번 데이터 영역에 들어가면 그 값 자체는 바뀌지 않는다** => 그래서 불변이라고 하는 것

### 가변값 
- 참조형 데이터는 기본 성질이 가변값인 경우가 많지만, 설정에 따라 변경이 불가능한 경우도 있고 아예 불변값으로 활용되기도 함
- 기본형 데이터와 참조형의 차이는 **객체(프로퍼티)**의 변수 영역이 별도로 존재한다는 것
- 객체가 별도로 할애한 영역은 변수영역일뿐 데이터 영역은 기존의 메모리 공간을 그대로 활용하고 있음.
- 데이터 영역에 저장된 값은 불변값. 그러나 객체의 변수영역에는 얼마든지 다른 값을 대입할 수 있음(다른 값을 대입한다면, 다른 값을 가리키는 데이터 영역의 주소값을 바꿔주면 되는거) => 참조형 데이터는 불변하지 않다
- **참조형 데이터 자체는 주소값을 참조한다** 
- 객체의 값을 갱신할 때 새로운 객체가 만들어지고 기존 값은 불변으로 계속 살아있는게 아니라(그러면 값이 불변하다고 말할 수 있을 텐데), 객체 내부의 프로퍼티 변수가 가리키는 **데이터 영역의 주소**가 바뀐다 => 객체 내부의 값은 (한번 선언되면 계속 존재하는게 아니고) 갱신될 수 있다 => 가변값이다

#### 참조형 데이터 변수할당
```js
var obj1 = {
    a:1,
    b:'bbb'
}
// 변수영역
// 1002번 : 식별자: obj1, 값: @5001
// 객체의 변수영역
// 7103~ : 식별자 a, 값 @5003....

// 데이터 영역
// 5001번 : @7103~ ? 
// 5003번 : 1
// 5004번 : 'bbb'
// ...

객체 식별자 => 객체 프로퍼티들의 변수영역 주소 범위 => 객체 프로퍼티의 데이터영역 주소 => 데이터영역에 있는 값
1002 => 5001 => 7103~ => 5003~

```
1. 컴퓨터는 변수 영역의 빈 공간 확보하고, 주소의 이름을 obj1로 지정
2. 그룹 내부의 프로퍼티들을 저장하기 위해 별도의 변수 영역을 마련한 후 그 영역의 주소를 @5001에 저장
3. 범위 주소들에 대해서 식별자 이름(프로퍼티 이름)저장
4. 프로퍼티들의 값으로 데이터 영역 주소 할당


#### GC
- 참조 카운트 : 자신의 주소를 참조하는 변수의 개수
- **참조 카운트가 0인 메모리 주소는 가비지 컬렉터의 수거대상**
- 런타임 환경에 따라 특정 시점이나 메모리 사용량이 포화 상태에 임박할 때마다 자동으로 수거 대상들을 수거한다. => 다시 빈공간이 됨

## 가변값 vs 불변값 비교

### 변수 복사
```js
// 불변값의 복사
var a = 10;
var b = 10;
b = 15

// 가변값의 복사
var obj1 = {c:10, d:'ddd'};
var obj2 = obj1;
obj2.c = 20;
```

#### 불변값의 복사(깊은복사)
1. 변수공간 @1002를 확보하고 식별자를 b로 지정함
2. @1001에 저장된 @5001을 들고 좀 전에 확보한 @1002값으로 대입 
3. 나중에 b의 값을 바꾸면 @5001을 바라봤던 b는 다른 데이터영역 주소를 참조함 => **b의 값을 바꿔도 a에 영향 미치지 않음**

#### 가변값의 복사(얕은복사)
1. 변수공간 @1004를 확보하고 식별자를 obj2로 지정
2. 식별자 obj1을 검색해 그 값인 @5002를 들고 @1004에 값대입
3. obj2와 obj1은 동일한 주소범위를 참조하고 있기 때문에 => **obj2의 값을 변경하면 obj1도 따라서 변경됨**

#### 관련해서 
- 변수를 복사하는 과정은 기본형이든 참조형이든 복사변수가 **피복사변수가 바라보는 주소와 동일한 주소를 바라보게** 된다는 점에서 동일
- 어떤 데이터 타입이든 변수에 할당하기 위해서는 주솟값을 복사해야 하기 때문에 엄밀히 따지면 자바스크립트의 모든 데이터 타입은 참조형임
- 다만 기본형은 주솟값을 복사하는 과정이 한번만 이뤄지고, 참조형은 한 단계를 더 거치게 된다는 차이
```js
var obj1 = {c:10, d:'ddd'};
var obj2 ={c:20, d:'ddd'};
```
- 이렇게 하면 객체에 대한 변경임에도 값을 다르게 하여 수정할 수 있음- 불변하게 수정 가능하다: 데이터 영역의 기존 ~는 그대로 있고(참조카운트가 0이 되었으니 gc될 것이고) 새로운 ~가 만들어지고 그 아래에 새로운 변수들이 만들어지고 변수 식별자는 그걸 참조
- 참조형 데이터가 가변값이라고 설명할 때의 가변은 참조형 데이터 자체를 변경할 경우가 아니라 그 내부의 프로퍼티를 변경할 때만 성립됨

## reference
- [코어 자바스크립트 - 데이터 타입](http://www.yes24.com/Product/Goods/78586788?scode=032&OzSrank=1)