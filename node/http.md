# HTTP

빠른 정리

## HTTP 프로토콜

1. 웹 상 클라이언트와 서버 사이 데이터를 주고받기 위해 정의된 프로토콜
2. 나는 이렇게 줄 테니 넌 이렇게 받고 난 너가 준거 그렇게 받을게
3. 상태가 없는 (stateless)프로토콜, 상태가 없다는 이야기는 데이터를 주고 받기 위한 각각의 데이터 요청이 서로 독립적으로 관리된다 => 각각 다른 데이터 요청은 서로 독립적이라는 말
4. 클라이언트 : 요청을 보내는 쪽, 일반적으로 웹 관점에서는 브라우저
5. 서버 : 요청을 받는 쪽, 일반적으로 데이터를 보내주는 원격지의 컴퓨터

## url

1. 프로토콜(http/https) + 호스트 + 포트 + 리소스 패스 + 쿼리
2. 서버에 특정 데이터를 요청할 수 있다. 여기에 요청하는 데이터에 특정 동작을 수행하고 싶으면 => http요청 메소드 사용(post, get, put, delete)

## 상태코드

1. 2xx : 성공
2. 3xx : 리다이렉션 - 클라이언트가 이전 주소(업뎃이 안된)로 데이터를 요청하여 서버에서 새 유알엘로 리다이렉트를 유도
3. 4xx : 클라이언트 에러 - 잘못된 요청, 유효하지 않은 자원을 요청했거나 요청이나 권한이 잘못된 경우
4. 5xx : 서버 쪽에서 오류가 난 경우

## 요청 메시지 구조

1. 요청 라인
   - 요청 메소드
   - 요청 url
   - http 버전
2. 요청 헤더(키-값)
   1. 공통
      - Date : http메시지가 만들어진 시각
      - connection : keep-alive
      - content-length : 요청과 응답 메시지의 본문 크기를 바이트 단위로 표시
      - cache-control : 캐시
      - content-type : 컨텐츠의 타입과 문자열 인코딩 명시
      - content-language : 사용자 언어
   2. 요청
      - host : 서버 도메인 네임
      - **user-agent** : 현재 사용자가 어떤 클라이언트를 통해 요청을 보냈는지
      - accept : 클라이언트가 허용할 수 있는 파일 형식
      - **cookie** : 웹 서버가 클라이언트에 쿠키를 저장해 놓았다면 해당 쿠키의 정보를 이름-값 쌍으로 웹서버에 전송
      - origin : post 같은 요청을 보낼 때 요청이 어느 주소에서 시작되었는지를 나타내는데, 이때 보낸 주소와 받는 주소가 다르면 cors가 발생
      - **Authorization** : 인증 토큰을 서버로 보낼때 사용하는 헤더. 요청같은거 할때 토큰이 없으면 거절당함
3. 요청 바디
   1. form형태 (url encoded)
   2. json형태
   3. 멀티파트 형태(이진파일)

## 응답 헤더

1. server : 웹서버 정보
2. Access-Control-Allow-Origin : 요청 호스트와 응답 호스트가 다르면 CORS에러가 발생하는데, 서버에서 응답 메시지 Access-Control-Allow-Origin 헤더에 프론트 주소를 적어주면 에러가 발생하지 않는다
3. allow : 받을 수 있는 요청 메소드 명시
4. content-security-policy : 다른 외부 파일들을 불러오는 경우 차단할 소스와 불러올 소스를 명시할 수 있음

## 쿠키 vs 세션

**1. 쿠키** : 클라이언트 로컬에 저장되는 데이터 문자열

- 아주 작은 데이터로 파일에 저장됨
- 서버가 어떤 주기동안 클라이언트의 상태를 알아줬으면 하는 데이터를 클라이언트 쪽에 저장
- 즉 클라이언트 쪽에 저장되지만 요청 헤더에 포함 될수 있어 서버에서 이 데이터를 받아볼 수 있더라
- 도메인에 반복 요청을 할 때도 자동으로 쿠키가 같이 전송된다. 서버 입장에서는 이 유저가 어떤 유저인지를 알 수 있음.
- 단점 : 브라우저에 저장되므로 보안에 취약함. 그리고 저장되는게 한계가 있음

**2. 세션** : 서버에서 클라이언트의 상태를 유지하는 수단

- 일정 시간동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 서버에 유지시키는 기술
- 클라이언트가 요청을 보내면, 해당 서버의 엔진이 클라이언트마다 고유한 id를 부여하고 저장하는데, 이 id가 세션 id임
- 민감한 정보를 클라이언트에다가 저장할 필요 없이, 쿠키에는 세션 id만 등록해놓고, request시 세션id를 서버로 보내면 세션 id를 기준으로 데이터를 찾아 읽으면 그만
- 쿠키에는 세션 아이디만 저장하면 되므로, 서버에서 세션을 생성한 후 세션 id를 쿠키에 알려줘야 함. 이때 **set-cookie헤더에 session_id를 담아 응답 헤더로 전달하게 된다**
- 단점 : 서버의 자원을 사용하기 때문에 서버에 부하를 준다
